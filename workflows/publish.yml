on:
    workflow_dispatch:
    push:
        branches: main

name: Quarto Publish
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - name: Update ubuntu packages
          run: sudo apt-get update
        
        - name: Install ubuntu dependencies
          run:  sudo apt-get install libcgal-dev libglu1-mesa-dev libcurl4-openssl-dev zlib1g-dev libfontconfig1-dev libharfbuzz-dev libfribidi-dev libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev
  
        - name: Check out repository
          uses: actions/checkout@v4

        - name: Configure GitHub Pages
          uses: actions/configure-pages@v3        
  
        - name: Set up Quarto
          uses: quarto-dev/quarto-actions/setup@v2
  
        - name: Install R
          uses: r-lib/actions/setup-r@v2
          with:
            r-version: '4.3.2'
  
        - name: Install R Dependencies
          uses: r-lib/actions/setup-renv@v2
          with:
            cache-version: 1
  
        - name: Render
          run: quarto render

        - name: Upload artifact
          uses: actions/upload-pages-artifact@v3
    deploy:
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
      runs-on: ubuntu-latest
      needs: build
      steps:
        - name: Deploy to GitHub Pages
          id: deployment
          uses: actions/deploy-pages@v4
